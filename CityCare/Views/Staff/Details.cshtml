@model CityCare.Models.ViewModels.StaffIssueDetailsViewModel
@using CityCare.Models.Entities

@{
    ViewData["Title"] = "Complaint Details";
    var issue = Model.Issue;

    string badgeClass = issue.Status switch
    {
        IssueStatus.Pending => "bg-warning text-dark",
        IssueStatus.InProgress => "bg-info text-dark",
        IssueStatus.Resolved => "bg-success",
        _ => "bg-secondary"
    };
}

<div class="container py-4" style="max-width: 900px;">

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show">
            @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="d-flex justify-content-between mb-3">
        <h3>Complaint Details</h3>
        <a class="btn btn-outline-secondary" asp-action="Dashboard">Back</a>
    </div>

    <div class="card shadow-sm mb-3">
        <div class="card-body">
            <div class="d-flex justify-content-between">
                <div>
                    <h5>@issue.Title</h5>
                    <div class="text-muted small">
                        Citizen: @issue.Citizen?.FullName
                    </div>
                </div>
                <span class="badge @badgeClass px-3 py-2">@issue.Status</span>
            </div>

            <hr />

            <p><strong>Category:</strong> @issue.Category</p>
            <p><strong>City:</strong> @issue.City?.Name</p>
            <p><strong>Location:</strong> @issue.LocationText</p>
            <p><strong>Description:</strong><br />@issue.Description</p>
        </div>
    </div>

    <div class="card shadow-sm mb-3">
        <div class="card-body">
            <h6>Images</h6>

            @if (issue.Images == null || !issue.Images.Any())
            {
                <p class="text-muted">No images uploaded.</p>
            }
            else
            {
                <div class="row g-3">
                    @foreach (var img in issue.Images)
                    {
                        <div class="col-md-4">
                            <a href="@img.ImageUrl" target="_blank">
                                <img src="@img.ImageUrl" class="img-fluid rounded border" />
                            </a>
                        </div>
                    }
                </div>
            }
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <h6>Update Status</h6>

            <form asp-action="UpdateStatus" method="post">
                @Html.AntiForgeryToken()

                <input type="hidden" asp-for="Issue.Id" />

                <div class="mb-3">
                    <select asp-for="NewStatus" class="form-select">
                        <option value="@IssueStatus.Pending">Pending</option>
                        <option value="@IssueStatus.InProgress">In Progress</option>
                        <option value="@IssueStatus.Resolved">Resolved</option>
                    </select>
                </div>

                <button class="btn btn-primary">Update Status</button>
            </form>
        </div>
    </div>
</div>
